import{j as e,r as d,R as sa}from"./react-CKCdxiP2.js";import{c as as}from"./react-dom-C-hGpMv2.js";import{B as ss}from"./react-router-dom-drmNJ_vF.js";import{F as ta,f as ts,a as ns,b as os,c as is}from"./@fortawesome-BGDMqZN5.js";import{u as le,a as rs,b as ce}from"./react-router-RiHmnZln.js";import{p as ls}from"./dompurify-B551CwFq.js";import{u as T,a as G,P as cs}from"./react-redux-DCjqPoSx.js";import{c as oe,a as ds}from"./@reduxjs-Bh5-wn6t.js";import{a as us}from"./axios-BimPEqV4.js";import{e as ms,__tla as ps}from"./tiktoken-CmgUnfQn.js";import{t as gs,u as xs,v as ys,w as hs,x as bs,y as vs,z as fs,A as As,B as js,D as Ss,G as Es,H as Ts,I as na}from"./@firebase-OY0NoFzM.js";import{C as ve,R as Z,a as U,F as J,B as Ns,S as Ds}from"./react-bootstrap-Cs9v543x.js";import{g as ks,s as Cs}from"./firebase--tSASyJa.js";import{S as Is}from"./react-singleton-hook-DVU2exgV.js";import"./classnames-C9FZUsQl.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-C0MJ9PeH.js";import"./prop-types-ZMHxiqrO.js";import"./use-sync-external-store-CwxkZ5If.js";import"./redux-DITMfSWq.js";import"./immer-CB3DrEpv.js";import"./redux-thunk-ClJT1hhx.js";import"./idb-BXWtuYvb.js";import"./@restart-BWEWayHJ.js";import"./tslib-BGVaTf34.js";Promise.all([(()=>{try{return ps}catch{}})()]).then(async()=>{(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const u of t.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function s(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerPolicy&&(t.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?t.credentials="include":i.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(i){if(i.ep)return;i.ep=!0;const t=s(i);fetch(i.href,t)}})();const oa="/",ia="/dialogueCorrector",ra="/startMenu",la="/dialog",ca="/debug",da="/corrections",ae={START_APP_ROUTE:oa,BASE_ROUTE:ia,START_MENU_ROUTE:ra,DIALOG_ROUTE:la,DEBUG_ROUTE:ca,CORRECTIONS_ROUTE:da},ua=()=>{const a=le();return{onClickNavigateToPath:s=>{a(s)}}},de=({id:a,classStyle:s,children:o,path:i,type:t,onClick:u})=>{const{onClickNavigateToPath:n}=ua();return e.jsx(e.Fragment,{children:t==="button"&&u?e.jsx("button",{id:a,type:"button",className:"btn btn-active-color "+s,onTouchEnd:u,children:o}):t==="button"&&!u?e.jsx("button",{id:a,type:"button",className:"btn btn-active-color "+s,onTouchEnd:()=>n(i),children:o}):e.jsx("button",{id:a,type:t,className:"btn btn-active-color "+s,children:o})})},fe=({navBrand:a,navBtns:s})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"navbar-wrapper",children:e.jsx("nav",{className:"navbar navbar-custom navbar-expand-sm",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"navbar-brand",children:e.jsx("div",{className:"navbar-brand-grid-container",children:a.name?e.jsx(e.Fragment,{children:e.jsx("div",{className:"nameGrid align-items-center",children:e.jsx("div",{className:"name",children:a.name})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"onlyIconGrid",children:e.jsx("div",{className:"icon",children:a.icon})})})})}),e.jsx("div",{className:"collapse navbar-collapse",id:"navbarNav",children:e.jsx("div",{className:"navbar-nav ms-auto mb-2 mb-lg-0",children:s.map((o,i)=>e.jsx("div",{className:"nav-btn-item",children:e.jsx(de,{id:o.name,path:o.path,type:"button",children:e.jsx(ta,{className:"nav-btn-icon",icon:o.icon})})},i))})})]})})})}),ma=a=>({__html:ls.sanitize(a)}),pa=({msg:a,icon:s})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"footer-wrapper",children:e.jsx("div",{className:"footer-custom",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-1 icon",children:e.jsx("div",{children:s})}),e.jsx("div",{className:"col-11 text",children:e.jsx("div",{dangerouslySetInnerHTML:ma(a)})})]})})})})}),Ae="/dialogueCorrector/assets/robot-speaking-39zUrFRN.gif",ga="/dialogueCorrector/assets/load-icon-4INARmNJ.gif",Q={avatarNotSpeakingIcon:{imageSrc:Ae,imageAlt:"Ojos en reposo",imageAttribution:"GIF local",searchLink:""},avatarSpeakingIcon:{imageSrc:Ae,imageAlt:"Ojos hablando",imageAttribution:"GIF local",searchLink:""},loadingIcon:{imageSrc:ga,imageAlt:"cargando",imageAttribution:"Avatar Speaking Icon created by Raquel Arcaz Arias",searchLink:""}},ue={messages:[],contextTokensTotal:0},je=oe({name:"openAIState",initialState:ue,reducers:{addMessage:(a,s)=>{a.messages.push(s.payload)},setMessages:(a,s)=>{a.messages=s.payload},resetMessages:a=>{a.messages=ue.messages},incrementTotalTokensWith:(a,s)=>{a.contextTokensTotal+=s.payload},resetTotalTokens:a=>{a.contextTokensTotal=0},resetOpenAIState:a=>{a.messages=ue.messages,a.contextTokensTotal=0}}}),{addMessage:Os,setMessages:xa,resetMessages:Ms,incrementTotalTokensWith:ya,resetTotalTokens:ha,resetOpenAIState:me}=je.actions,ba=je.reducer,va=(a,s,o=2,i=8e3)=>{let t=1;const u=async()=>{try{return await a()}catch(n){if(t>o)throw n;const x=i*2**t;return s(`Retry attempt ${t} after ${x}ms`),await new Promise(r=>setTimeout(r,x)),t++,u()}};return u()},fa="https://api.openai.com/v1/chat/completions",Aa="sk-proj-bzvBEBksscDhLiCOBayDT3BlbkFJXeknAa8SdhW9S0Mg9Heq",Se=()=>{const{printDebug:a}=d.useContext(P),s=async(o,i)=>{try{const t=(await va(async()=>us.post(fa,{model:"gpt-3.5-turbo-1106",messages:o,max_tokens:i||4096},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${Aa}`}}),a)).data.choices[0].message.content;return a(`+++ INSIDE askGPT => ${t}`),t||"No s\xE9 la respuesta a esa pregunta"}catch(t){return a(`+++ ERROR in askGPT +++ => ${t.message}`),"Lo siento, en estos momentos no puedo contestar a tu pregunta. Por favor, vuelve a intentarlo m\xE1s tarde"}};return d.useEffect(()=>{},[]),{askGPT:s}},ja=()=>{const a=T(n=>n.openAIState.contextTokensTotal),s=G(),{printDebug:o}=d.useContext(P),i=n=>{const x=t(n);u(x)},t=n=>ms("gpt-3.5-turbo-1106").encode(n).length,u=n=>{s(ya(n))};return{handleIncrementOfTokensNumber:i,countTokens:t,isContextTokensThresholdOvercomeBy:n=>{const x=a+n;return o(`+++ isContextTokensThresholdOvercomeBy() - tokensTotalNumber => ${JSON.stringify(x)} `),x>12e3},resetContextTokensTotal:()=>{s(ha())}}},pe=()=>{const a=T(o=>o.userDBState.userData.docRef),{getFirestoreDb:s}=d.useContext(he);return d.useContext(P),{addUserToFirebaseDB:async o=>{let i=null;try{const t=await s();if(t){const u=gs(t,"users");i=await xs(u,o)}else throw new Error("Failed adding new user to Firebase collection. DETAILS: Could not get database instance.")}catch(t){throw new Error(`Failed adding new user to Firebase collection. DETAILS: ${t}`)}return i||null},addUserAndAIMessageToFirebaseDB:async o=>{try{if(await s()&&a)await ys(a,{messages:hs(o)});else throw new Error("Failed adding message. DETAILS: Could not get database instance or userDocRef is null.")}catch(i){throw new Error(`Failed adding message to Firebase collection. DETAILS: ${i}`)}}}},ge=()=>{const a=G(),{askGPT:s}=Se(),{handleIncrementOfTokensNumber:o,countTokens:i,isContextTokensThresholdOvercomeBy:t,resetContextTokensTotal:u}=ja(),{addUserAndAIMessageToFirebaseDB:n}=pe(),{printDebug:x}=d.useContext(P),r=async(p,l)=>v(p,l,!0,!1),g=async(p,l)=>v(p,l,!0,!0),b=async(p,l,S)=>v(p,l,!1,!0,S),v=async(p,l,S,C,_)=>{let H="";return await L(p,l),S&&!C?(k(p,l),H=await s(l),j(H,l)):S&&C?(await h(p,l),H=await s(l),await D(H,l)):!S&&C&&(await B(p,l),H=await s(l,75),_&&(H=`${H} 
        He notado que te sientes ${_}. \xBFEs cierto?. \xBFPodr\xEDas describirme mejor tus sentimientos en este momento?`),await D(H,l)),H},k=(p,l)=>{c("system",p,l)},h=async(p,l)=>{await m("system",p,l)},j=(p,l)=>{c("assistant",p,l)},D=async(p,l)=>{await m("assistant",p,l)},B=async(p,l)=>{await m("user",p,l)},c=(p,l,S)=>{const C=I(p,l);w(S,C)},m=async(p,l,S)=>{const C=I(p,l);w(S,C),f(p,l),o(l)},I=(p,l)=>({role:p,content:l}),w=(p,l)=>{p.push(l)},L=async(p,l)=>{t(i(p))&&await F(l)},F=async p=>{const l=await y(p);O(p),x(`+++ Inside restartConversationContextAndNumberOfTokens() - resetMessagesArray => ${JSON.stringify(p)} `);const S=`Voy a enviarte un resumen de la \xFAltima conversaci\xF3n que has mantenido con un usuario. 
      Necesito que analices dicho resumen y que respondas a las peticiones del usuario teniendo en cuenta el contexto de la conversaci\xF3n extra\xEDdo del resumen. 
      El resumen es el siguiente: ${l}`;await h(S,p),u(),o(S)},y=async p=>{let l=[...p];const S=I("system",`Te voy a proporcionar toda la conversaci\xF3n mantenida entre un usuario y la API de Open AI. 
       Necesito que me hagas un resumen de la conversaci\xF3n para poder seguir conversando con el usuario manteniendo el mismo contexto del di\xE1logo.
       Recuerda que deber\xE1s devolverme como respuesta \xFAnicamente el resumen que has realizado de la conversaci\xF3n.`);return l.shift(),l.unshift(S),x(`+++ Inside resumeConversation() - conversationMessages => ${JSON.stringify(l)} `),await s(l)},O=p=>{p.length=0},E=p=>{a(xa(p))},f=async(p,l)=>{const S=I(p,l);await n(S)};return{getResponseToNewSystemMessageWithoutUpdatingTokens:r,getResponseToNewSystemMessage:g,getResponseToNewUserMessage:b,addSystemMessageAndUpdateTokens:h,addUserMessageAndUpdateTokens:B,addSystemMessageWithoutUpdateTokens:k,addAssistantMessageAndUpdateTokens:D,handleRestartContext:L,setOpenAIMessages:E,addMessageToDB:f}},Ee={0:"Hello! I'm Alexa, your language teacher. Before we start, could you please tell me your name?",1:"\xA1Hola! Soy Alexa, tu profesora de idiomas. Antes de empezar, \xBFpodr\xEDas decirme tu nombre?",2:"Bonjour ! Je suis Alexa, votre professeure de langues. Avant de commencer, pourriez-vous me dire votre nom ?"},Te=[{key:0,code:"en-US",name:"English",voice:"Salli"},{key:1,code:"es-ES",name:"Espa\xF1ol",voice:"Lucia"},{key:2,code:"fr-FR",name:"Fran\xE7ais",voice:"Lea"}],Ne={A1:{key:"A1",name:"Principiante",description:"Comprensi\xF3n y uso de expresiones cotidianas b\xE1sicas."},A2:{key:"A2",name:"B\xE1sico",description:"Comprensi\xF3n de frases y expresiones frecuentes en contextos conocidos."},B1:{key:"B1",name:"Intermedio",description:"Comprensi\xF3n de puntos principales en temas habituales como trabajo o estudios."},B2:{key:"B2",name:"Intermedio Alto",description:"Comprensi\xF3n de ideas principales en textos complejos y capacidad para interactuar fluidamente."},C1:{key:"C1",name:"Avanzado Alto",description:"Capacidad de expresarse con fluidez y precisi\xF3n en temas complejos."},C2:{key:"C2",name:"Maestr\xEDa",description:"Comprensi\xF3n completa y uso adecuado del idioma en cualquier contexto."}},De={A1:[{key:1,name:"Presentaciones personales",description:"Habla sobre tu nombre, edad, y de d\xF3nde eres."},{key:2,name:"Rutinas diarias",description:"Describe las actividades que haces cada d\xEDa, como ir al trabajo o a la escuela."},{key:3,name:"La familia",description:"Habla sobre los miembros de tu familia (padres, hermanos, etc.)."},{key:4,name:"Comidas y bebidas",description:"Describe tus comidas y bebidas favoritas."},{key:5,name:"Direcciones",description:"Pregunta y da indicaciones para llegar a un lugar."},{key:6,name:"La casa",description:"Habla sobre las partes de una casa y los objetos que hay en cada habitaci\xF3n."},{key:7,name:"El tiempo y el clima",description:"Describe el clima en tu ciudad o c\xF3mo es el clima hoy."},{key:8,name:"Actividades de tiempo libre",description:"Habla sobre lo que te gusta hacer en tu tiempo libre (leer, ver televisi\xF3n, etc.)."},{key:9,name:"Compras",description:"Practica c\xF3mo pedir y comprar cosas en una tienda o supermercado."},{key:10,name:"Lugares de la ciudad",description:"Describe lugares comunes en la ciudad como parques, estaciones de tren, o supermercados."}],A2:[{key:11,name:"Vacaciones",description:"Habla sobre tus vacaciones pasadas o d\xF3nde te gustar\xEDa ir."},{key:12,name:"La salud",description:"Describe c\xF3mo te sientes o habla sobre una visita al m\xE9dico."},{key:13,name:"Planes futuros",description:"Habla sobre lo que vas a hacer el pr\xF3ximo fin de semana o en el futuro cercano."},{key:14,name:"Trabajo y profesiones",description:"Describe tu trabajo o el trabajo de personas que conoces."},{key:15,name:"Describir personas",description:"Habla sobre la apariencia y personalidad de amigos o familiares."},{key:16,name:"El transporte",description:"Habla sobre c\xF3mo te desplazas por la ciudad (autob\xFAs, tren, coche)."},{key:17,name:"Invitaciones",description:"C\xF3mo invitar a alguien a una fiesta o rechazar/aceptar una invitaci\xF3n."},{key:18,name:"Describir lugares",description:"Habla sobre tu ciudad o un lugar que has visitado."},{key:19,name:"Hablar sobre gustos y preferencias",description:"Explica qu\xE9 te gusta y qu\xE9 no te gusta en relaci\xF3n con comida, deportes, m\xFAsica, etc."},{key:20,name:"Experiencias pasadas",description:"Habla sobre una experiencia sencilla en el pasado, como una excursi\xF3n o una fiesta."}],B1:[{key:21,name:"Rutinas diarias y h\xE1bitos",description:"Describe tu d\xEDa t\xEDpico o las actividades de fin de semana."},{key:22,name:"Viajes y vacaciones",description:"Habla sobre un viaje o destino de vacaciones memorable."},{key:23,name:"Salud y bienestar",description:"Comenta c\xF3mo mantener un estilo de vida saludable."},{key:24,name:"Educaci\xF3n y vida escolar",description:"Describe tu experiencia escolar o educativa."},{key:25,name:"Aficiones y tiempo libre",description:"Comparte tus pasatiempos favoritos y explica por qu\xE9 los disfrutas."},{key:26,name:"Planes futuros",description:"Habla sobre tus metas futuras o aspiraciones profesionales."},{key:27,name:"Compras y consumismo",description:"Comenta sobre tus h\xE1bitos y preferencias de compra."},{key:28,name:"Tecnolog\xEDa en la vida cotidiana",description:"Explica c\xF3mo la tecnolog\xEDa impacta tu vida."},{key:29,name:"Eventos culturales y tradiciones",description:"Habla sobre una tradici\xF3n cultural importante en tu pa\xEDs."},{key:30,name:"Familia y amigos",description:"Describe el papel de la familia y las amistades en tu vida."}],B2:[{key:31,name:"Redes sociales y comunicaci\xF3n",description:"Habla sobre los pros y los contras de las redes sociales."},{key:32,name:"Problemas ambientales",description:"Habla sobre los mayores problemas ambientales y c\xF3mo abordarlos."},{key:33,name:"Sistemas educativos",description:"Compara diferentes sistemas educativos y su efectividad."},{key:34,name:"Mercado laboral y empleo",description:"Comenta los desaf\xEDos y oportunidades en el mercado laboral."},{key:35,name:"Experiencias de viaje y diferencias culturales",description:"Habla sobre las diferencias culturales que has encontrado mientras viajabas."},{key:36,name:"Tecnolog\xEDa e innovaci\xF3n",description:"Comenta el impacto de los avances tecnol\xF3gicos recientes en la sociedad."},{key:37,name:"Globalizaci\xF3n",description:"Explora los efectos de la globalizaci\xF3n en las culturas y econom\xEDas locales."},{key:38,name:"Salud y bienestar",description:"Habla sobre la salud mental y su importancia en la sociedad moderna."},{key:39,name:"Consumo \xE9tico",description:"Comenta la importancia de comprar productos de origen \xE9tico."},{key:40,name:"Trabajo voluntario y responsabilidad social",description:"Comparte los beneficios del voluntariado y su impacto en las comunidades."}],C1:[{key:41,name:"El papel de la inteligencia artificial",description:"Habla sobre las implicaciones \xE9ticas de la IA en la vida cotidiana."},{key:42,name:"Cambio clim\xE1tico y sostenibilidad",description:"Debate soluciones para combatir el cambio clim\xE1tico."},{key:43,name:"Reforma educativa",description:"Analiza c\xF3mo se podr\xEDan mejorar los sistemas educativos."},{key:44,name:"El futuro del trabajo",description:"Explora c\xF3mo el teletrabajo y la automatizaci\xF3n cambiar\xE1n los mercados laborales."},{key:45,name:"Desaf\xEDos globales de salud",description:"Habla sobre los problemas de salud globales, como las pandemias, y c\xF3mo se pueden gestionar."},{key:46,name:"Identidad cultural en un mundo globalizado",description:"Debate si la globalizaci\xF3n amenaza o enriquece la diversidad cultural."},{key:47,name:"Influencia de las redes sociales en la opini\xF3n p\xFAblica",description:"Habla sobre c\xF3mo las redes sociales moldean la pol\xEDtica y los movimientos sociales."},{key:48,name:"Dependencia tecnol\xF3gica",description:"Explora los efectos de la creciente dependencia de la tecnolog\xEDa en las interacciones humanas."},{key:49,name:"Privacidad vs. seguridad",description:"Discute el equilibrio entre la privacidad personal y la seguridad nacional."},{key:50,name:"El papel del arte y la literatura en la sociedad",description:"Debate la importancia de las artes para reflejar y moldear la cultura."}],C2:[{key:51,name:"\xC9tica de la ingenier\xEDa gen\xE9tica",description:"Debate los l\xEDmites morales de la modificaci\xF3n gen\xE9tica humana."},{key:52,name:"Impacto de la globalizaci\xF3n en los pa\xEDses en desarrollo",description:"Habla sobre si la globalizaci\xF3n beneficia o perjudica a las naciones en desarrollo."},{key:53,name:"Filosof\xEDa de la mente",description:"Explora teor\xEDas sobre la relaci\xF3n entre la conciencia y el cerebro."},{key:54,name:"Inteligencia artificial y creatividad humana",description:"Debate si la IA puede llegar a replicar completamente la creatividad humana."},{key:55,name:"Libre albedr\xEDo vs. determinismo",description:"Discute si los humanos realmente tienen libre albedr\xEDo o si nuestras acciones est\xE1n predeterminadas."},{key:56,name:"El papel de los medios en la formaci\xF3n del pensamiento pol\xEDtico",description:"Analiza la influencia de los medios de comunicaci\xF3n en las pol\xEDticas p\xFAblicas y la opini\xF3n p\xFAblica."},{key:57,name:"Desigualdad social en la era digital",description:"Discute c\xF3mo internet y la tecnolog\xEDa afectan las disparidades socioecon\xF3micas."},{key:58,name:"Apropiaci\xF3n cultural vs. apreciaci\xF3n cultural",description:"Debate la delgada l\xEDnea entre adoptar y explotar otra cultura."},{key:59,name:"El concepto de la pol\xEDtica post-verdad",description:"Explora c\xF3mo se manipulan los hechos y la verdad en el discurso pol\xEDtico moderno."},{key:60,name:"\xC9tica ambiental",description:"Discute la responsabilidad \xE9tica que los humanos tienen para preservar la biodiversidad y los ecosistemas."}]},se=()=>(d.useContext(P),{getGreetings:a=>Ee[a],getGreetingsWithSSML:a=>Ee[a],getLanguageObjectByKey:a=>Te.find(s=>s.key==a),getLanguageLevelObjectByKey:a=>Ne[a],getLanguageTopicObjectByKey:(a,s)=>De[a].find(o=>o.key==s)}),ke={userData:{docRef:null,pseudonym:"",age:0,languageName:"",levelName:"",topicName:"",messages:[],timestamp:""}},Ce=oe({name:"userDBState",initialState:ke,reducers:{setUserDocRef:(a,s)=>{a.userData.docRef=s.payload},setUserPseudonym:(a,s)=>{a.userData.pseudonym=s.payload},setUserAge:(a,s)=>{a.userData.age=s.payload},addMessage:(a,s)=>{a.userData.messages.push(s.payload)},setTimestamp:(a,s)=>{a.userData.timestamp=s.payload},setUserData:(a,s)=>{a.userData=s.payload},resetUserData:a=>{a.userData=ke.userData}}}),{setUserDocRef:Ie,setUserPseudonym:Rs,setUserAge:qs,addMessage:ws,setTimestamp:Bs,setUserData:Oe,resetUserData:xe}=Ce.actions,Sa=Ce.reducer,Ea=(a,s)=>{const[o,i]=d.useState([]),[t,u]=d.useState(),[n,x]=d.useState(!1),r=T(m=>m.languageState.languageData.languageKey),g=T(m=>m.languageState.languageData.levelObject),{getResponseToNewSystemMessageWithoutUpdatingTokens:b,addMessageToDB:v}=ge(),{getLanguageObjectByKey:k}=se(),{printDebug:h}=d.useContext(P),j=G(),D=async m=>{var y,O;const I=[...m],w=`
      En base a una conversaci\xF3n mantenida con el usuario en el idioma ${(y=k(r))==null?void 0:y.name} y el nivel ${g.key} - ${g.name}.
      Necesito que realices una correcci\xF3n de las entradas del usuario del siguiente di\xE1logo ${m}. 
      Necesito que corrijas todas las entradas del usuario, teniendo en cuenta que el idioma hablado ha sido el  ${(O=k(r))==null?void 0:O.name}.
      Deber\xE1s separar por categor\xEDas los errores m\xE1s importantes cometidos por el usuario durante la conversaci\xF3n. 
      Para cada error detectado, deber\xE1s devolver la categor\xEDa de error cometido, la frase del usuario completa con el error cometido, 
      una explicaci\xF3n del error cometido y un ejemplo de c\xF3mo ser\xEDa la frase corregida. 

      Deber\xE1s responder siempre con el siguiente JSON con la informaci\xF3n solicitada y sin ning\xFAn otro texto adicional:
      {
        "corrections": [
          {
            "category": "<categor\xEDa>",
            "error": "<error>",
            "explanation": "<explanation>",
            "correction": "<correction>",
          }
          // Aqu\xED deben ir los dem\xE1s objetos correspondientes a los errores detectados
        ]
      }

      En el caso en el que no hayas detectado ning\xFAn error en los mensajes deber\xE1s devolver el array "corrections" vac\xEDo.
    `;h("BEFORE CORRECTIONS RESPONSE");const L=await b(w,I);h("AFTER CORRECTIONS RESPONSE => "+JSON.stringify(L)),await v("assistant",L);const F=JSON.parse(L);return h(`+++ getUserCorrections() - responseObject => ${JSON.stringify(m)} `),F.corrections};d.useEffect(()=>{(async()=>{try{const m=B(a);if(h("userMessages => "+m),m.length>3){x(!0);const I=await D(m);u(I)}else x(!1)}catch(m){console.error("Error fetching corrections:",m)}})()},[a,r]);const B=m=>m.filter(I=>I.role==="user"),c=m=>m.filter(I=>I.role!=="system");return d.useEffect(()=>{if(a.length>0){const m=c(a);i([...m]),h("INSIDE useEFFECt - filteredMessages => "+m)}},[a]),d.useEffect(()=>()=>{h("CORRECTIONS DISABLED"),j(me()),j(xe()),s(!1)},[s]),{messagesWithoutSystemEntries:o,corrections:t,messagesSufficientForCorrection:n}},Ta=({messages:a,setSeeCorrectionsEnabled:s})=>{const{messagesWithoutSystemEntries:o,messagesSufficientForCorrection:i,corrections:t}=Ea(a,s);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"corrections-list-container",children:i?t&&t.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"item-list",children:[e.jsx("h2",{className:"header",children:"Correcciones"}),t.map((u,n)=>e.jsxs("div",{className:"item-message",children:[e.jsx("h3",{className:"subheader",children:u.category}),e.jsxs("p",{className:"paragraph",children:[e.jsx("strong",{children:"Error: "})," ",u.error]}),e.jsxs("p",{className:"paragraph",children:[e.jsx("strong",{children:"Explicaci\xF3n: "})," ",u.explanation]}),e.jsxs("p",{className:"paragraph",children:[e.jsx("strong",{children:"Correcci\xF3n: "})," ",u.correction]})]},n))]}),e.jsx("hr",{className:"divider"}),e.jsxs("div",{className:"item-list",children:[e.jsx("h2",{className:"header",children:"Di\xE1logo"}),o.map((u,n)=>e.jsxs("div",{className:"item-message",children:[e.jsxs("p",{className:"paragraph",children:[e.jsx("strong",{children:"Rol: "}),u.role]}),e.jsxs("p",{className:"paragraph",children:[e.jsx("strong",{children:"Contenido: "})," ",u.content]})]},n))]})]}):e.jsx("div",{className:"grid-item item-icon-load-alexa-loading-view",children:e.jsx("img",{src:Q.loadingIcon.imageSrc,alt:Q.loadingIcon.imageAlt,className:"d-inline-block align-center"})}):e.jsx("div",{className:"correction-insufficient-messages",children:e.jsx("h3",{className:"subheader",children:e.jsx("strong",{className:"paragraph",children:"No hay mensajes suficientes para poder realizar la correcci\xF3n"})})})})})})},Na=({isLoading:a,isSpeechOn:s,latestTemperature:o,latestHumidity:i,latestMq2:t,latestMq3:u,latestMq7:n,latestMq135:x,latestMq138:r,handleOnTouchStartEvent:g,handleSeeCorrectionsOnTouchEvent:b})=>e.jsx("div",{className:"container-fluid",onTouchStart:g,children:e.jsx("div",{className:"container-menu",children:e.jsxs("div",{className:"speech-view-main-layout",children:[e.jsxs("div",{className:"sensors-left-panel",children:[e.jsx("div",{className:"sensor-display",children:o!==null?`\u{1F321}\uFE0F Temperatura: ${o.toFixed(1)} \xB0C`:"Cargando..."}),e.jsx("div",{className:"sensor-display",children:i!==null?`\u{1F4A7} Humedad: ${i.toFixed(1)} %`:"Cargando..."}),e.jsx("div",{className:"sensor-display",children:t!==null?`MQ-2 (Humo): ${t}`:"Cargando..."}),e.jsx("div",{className:"sensor-display",children:u!==null?`MQ-3 (Alcohol): ${u}`:"Cargando..."}),e.jsx("div",{className:"sensor-display",children:n!==null?`MQ-7 (CO): ${n}`:"Cargando..."}),e.jsx("div",{className:"sensor-display",children:x!==null?`MQ-135 (Aire): ${x}`:"Cargando..."}),e.jsx("div",{className:"sensor-display",children:r!==null?`MQ-138 (Qu\xEDmicos): ${r}`:"Cargando..."})]}),e.jsxs("div",{className:"main-content-right-panel",children:[e.jsxs("div",{className:"avatar-area",children:[a&&e.jsx("div",{className:"loading-icon-container",children:e.jsx("img",{src:Q.loadingIcon.imageSrc,alt:Q.loadingIcon.imageAlt,className:"loading-icon"})}),e.jsx("div",{className:"avatar-container",children:e.jsx("img",{src:s?Q.avatarSpeakingIcon.imageSrc:Q.avatarNotSpeakingIcon.imageSrc,alt:s?Q.avatarSpeakingIcon.imageAlt:Q.avatarNotSpeakingIcon.imageAlt,className:s?"speaking-glow":""})})]}),e.jsx("div",{className:"button-container",children:e.jsx(de,{id:"start",path:"/seeCorrections",onClick:b,classStyle:"btn-primary item-button",type:"button",children:"Ver correcciones"})})]})]})})});var V=(a=>(a.SEND_SPEECH="send-msg",a.START_SPEECH="start-saying-msg",a.END_SPEECH="end-saying-msg",a.NONE="none",a))(V||{}),K=(a=>(a.LOADING="loading",a.OK="ok",a.NOT_OK="not-ok",a))(K||{}),ie=(a=>(a.MICROPHONE_OPENED="opened",a.MICROPHONE_CLOSED="closed",a))(ie||{});const Me={data:{intentType:"",userRequest:""},voiceAPIStatus:K.LOADING,voiceMicroStatus:ie.MICROPHONE_CLOSED,voiceMsgProps:{body:"",status:V.NONE},deviceId:"1",processingUserRequest:!1},Re=oe({name:"voiceState",initialState:Me,reducers:{setVoiceAPIStatus:(a,s)=>{a.voiceAPIStatus=s.payload},setVoiceMicroStatus:(a,s)=>{a.voiceMicroStatus=s.payload},setVoiceMsgBody:(a,s)=>{a.voiceMsgProps.body=s.payload},setVoiceMsgStatus:(a,s)=>{a.voiceMsgProps.status=s.payload},setDeviceId:(a,s)=>{a.deviceId=s.payload},setProcessingUserRequest:(a,s)=>{a.processingUserRequest=s.payload},setUserSpeechData:(a,s)=>{a.data=s.payload},resetUserSpeechData:a=>{a.data=Me.data}}}),{setVoiceAPIStatus:re,setVoiceMicroStatus:qe,setVoiceMsgBody:Ps,setVoiceMsgStatus:te,setDeviceId:Da,setProcessingUserRequest:we,setUserSpeechData:ka,resetUserSpeechData:ye}=Re.actions,Ca=Re.reducer,Be=()=>{const a=T(r=>{var g;return(g=r.voiceState)==null?void 0:g.voiceAPIStatus}),s=T(r=>r.languageState.languageData.languageKey);T(r=>r.environmentState.isHighTemperatureAlertActive);const o=G(),{getLanguageObjectByKey:i}=se(),{printDebug:t,sendTextToAlexa:u}=d.useContext(P),n=async(r,g)=>{const b=x(r);await u(a,b,g),o(we(!1))},x=r=>{const g=i(s);t("Voice => "+(g==null?void 0:g.voice));let b=`<voice name="${g!=null&&g.voice?g.voice:"Lucia"}">
    <lang xml:lang='${g!=null&&g.code?g.code:"es-ES"}'>
    `;return b+=r,b+="</lang></voice>",b};return{speechResponseToUserRequest:n}},Ia=()=>{const{getResponseToNewSystemMessageWithoutUpdatingTokens:a,addMessageToDB:s,addUserMessageAndUpdateTokens:o}=ge(),{printDebug:i}=d.useContext(P),t=async r=>u(r)?await x(r):"",u=r=>(i(`+++ isTimeToMakeUserEmotionalAnalysis() - updatedNumberOfMessages => ${JSON.stringify(n(r))} `),n(r)>0&&n(r)%3===0),n=r=>r.filter(g=>g.role==="user").length,x=async r=>{const g=[...r],b=await a(`
      En base a la informaci\xF3n anterior proporcionada, que puede ser, o bien, 
      toda la conversaci\xF3n mantenida con el usuario, o bien, un resumen de la conversaci\xF3n mantenida con dicho usuario, 
      analiza dicha informaci\xF3n y devuelve el resultado del an\xE1lisis emocional del usuario 
      y la emoci\xF3n que m\xE1s se adec\xFAa al usuario en base a la conversaci\xF3n analizada.

      Responde \xFAnicamente con el siguiente JSON con la informaci\xF3n solicitada y sin ning\xFAn texto adicional:

      {
        "emotionalAnalysisSummary": "<resultadoAn\xE1lisisEmocional>", 
        "emotion": "<triste | alegre | aburrido | deprimido | enfadado | frustrado | disgustado | asustado | sorprendido>"
      }
    `,g),v=JSON.parse(b);return i(`+++ getUserEmotionalAnalysis() - responseObject => ${JSON.stringify(v)} `),i(`+++ getUserEmotionalAnalysis() - emotion => ${v.emotion} `),await s("assistant",v.emotionalAnalysisSummary),v.emotion};return{handleUserEmotionalAnalysis:t,addUserMessageAndUpdateTokens:o,getUserEmotionalAnalysis:x}},Pe={isHighTemperatureAlertActive:!1,isHighHumidityAlertActive:!1,isLowHumidityAlertActive:!1,isMq2AlertActive:!1,isMq3AlertActive:!1,isMq7AlertActive:!1,isMq135AlertActive:!1,isMq138AlertActive:!1},Le=oe({name:"environmentState",initialState:Pe,reducers:{setHighTemperatureAlert:(a,s)=>{a.isHighTemperatureAlertActive=s.payload},setHighHumidityAlert:(a,s)=>{a.isHighHumidityAlertActive=s.payload},setLowHumidityAlert:(a,s)=>{a.isLowHumidityAlertActive=s.payload},setMq2Alert:(a,s)=>{a.isMq2AlertActive=s.payload},setMq3Alert:(a,s)=>{a.isMq3AlertActive=s.payload},setMq7Alert:(a,s)=>{a.isMq7AlertActive=s.payload},setMq135Alert:(a,s)=>{a.isMq135AlertActive=s.payload},setMq138Alert:(a,s)=>{a.isMq138AlertActive=s.payload},resetEnvironmentState:a=>Pe}}),{setHighTemperatureAlert:He,setHighHumidityAlert:Ue,setLowHumidityAlert:_e,setMq2Alert:$e,setMq3Alert:Fe,setMq7Alert:ze,setMq135Alert:Ge,setMq138Alert:Ke,resetEnvironmentState:Ls}=Le.actions,Oa=Le.reducer,Ma=()=>{const a=(y,O,E,f)=>`
      Contexto:

      Act\xFAa como un profesor de idiomas enfocado en mejorar las habilidades comunicativas del usuario. Tu objetivo es mantener una conversaci\xF3n proactiva y continua con el usuario que le permita practicar en el progreso de un idioma. El idioma seleccionado es: ${O}.

      Deber\xE1s mantener una conversaci\xF3n con el usuario del nivel: ${E.key} - ${E.name}. En dicho nivel, el objetivo es el siguiente: ${E.description}. Deber\xE1s adaptar el nivel de complejidad del di\xE1logo al nivel de competencia del usuario indicado anteriormente.

      Deber\xE1s garantizar un di\xE1logo proactivo sobre el siguiente tema de conversaci\xF3n: ${f.name}. El objetivo de este di\xE1logo es: ${f.description}. Adem\xE1s, tambi\xE9n deber\xE1s tener en cuenta la edad del usuario que en este caso es: ${y}.
`,s=T(y=>y.userDBState.userData.age),o=T(y=>y.languageState.languageData.languageKey),i=T(y=>y.languageState.languageData.levelObject),t=T(y=>y.languageState.languageData.topicObject),{askGPT:u}=Se(),n=G(),{speechResponseToUserRequest:x}=Be();Ia();const{getGreetings:r,getLanguageObjectByKey:g}=se(),{getResponseToNewUserMessage:b,addSystemMessageAndUpdateTokens:v,addAssistantMessageAndUpdateTokens:k,setOpenAIMessages:h}=ge(),{isHighTemperatureAlertActive:j,isHighHumidityAlertActive:D,isLowHumidityAlertActive:B}=T(y=>y.environmentState),c=T(y=>y.environmentState),{printDebug:m}=d.useContext(P),I=async(y,O)=>{let E=[],f=[];if(j){m("Alerta de temperatura alta detectada. Generando respuesta combinada.");const S="Dame un consejo muy conciso y claro sobre qu\xE9 hacer si la temperatura ambiente es superior a 26 grados Celsius.";try{const C=await u([{role:"user",content:S}]);E.push(C),m(`Consejo de temperatura obtenido: ${C}`)}catch(C){m(`Error al obtener consejo de temperatura: ${C}`),E.push("He detectado que la temperatura es alta, pero he tenido un problema al generar un consejo. Por favor, ventila la habitaci\xF3n.")}f.push(He(!1))}if(D||B){let S="",C="";D?(m("Alerta de humedad alta detectada. Generando consejo."),S="La humedad es demasiado alta dentro de la habitaci\xF3n, lo que supone un riesgo sanitario y de desarrollo de moho. Ahora, dame un consejo muy conciso y claro sobre qu\xE9 hacer en esta situaci\xF3n.",C="He detectado que la humedad es muy alta, lo cual puede ser perjudicial. He tenido un problema al generar un consejo, pero te recomiendo ventilar bien.",f.push(Ue(!1))):(m("Alerta de humedad baja detectada. Generando consejo."),S="La humedad es demasiado baja en la habitaci\xF3n. Ahora, dame un consejo muy conciso y claro sobre qu\xE9 hacer para aumentarla.",C="He detectado que la humedad es muy baja. Esto puede causar sequedad. No he podido generar un consejo, pero usar un humidificador podr\xEDa ayudar.",f.push(_e(!1)));try{const _=await u([{role:"user",content:S}]);E.push(_),m(`Consejo de humedad obtenido: ${_}`)}catch(_){m(`Error al obtener consejo de humedad: ${_}`),E.push(C)}}c.isMq2AlertActive&&(E.push("Presencia peligrosa de humo, butano o propano"),f.push($e(!1))),c.isMq3AlertActive&&(E.push("Presencia peligrosa de vapores de alcohol"),f.push(Fe(!1))),c.isMq7AlertActive&&(E.push("Presencia excesiva de mon\xF3xido de carbono"),f.push(ze(!1))),c.isMq135AlertActive&&(E.push("Presencia peligrosa de aire contaminado"),f.push(Ge(!1))),c.isMq138AlertActive&&(E.push("Presencia peligrosa de vapores de productos qu\xEDmicos"),f.push(Ke(!1)));const p=await w(y,O);let l="";E.length>0?(l=E.join(" Adem\xE1s, "),l+=`. Por otro lado, y en cuanto a lo que mencionabas, ${p}`):l=p,m(`Respuesta final concatenada: ${l}`),await x(l),f.length>0&&f.forEach(S=>n(S))},w=async(y,O)=>{let E="",f=[...O];return L(f),E=await b(y,f,""),m(`+++ Inside getResponseToUserRequest() 3 - messagesCopy after => ${JSON.stringify(f)} `),h(f),E},L=y=>{var f;const O=(f=g(o))==null?void 0:f.name,E=r(o);F(y)&&O&&i&&t&&v(a(s,O,i,t),y),k(E,y)},F=y=>y.length===0;return{handleAnswerToGeneralUserInput:I,getResponseToUserRequest:w}},Ra=()=>{const[a,s]=d.useState(!1),[o,i]=d.useState(!1),[t,u]=d.useState(!1),[n,x]=d.useState(null),[r,g]=d.useState(null),[b,v]=d.useState(null),[k,h]=d.useState(null),[j,D]=d.useState(null),[B,c]=d.useState(null),[m,I]=d.useState(null),w=T(M=>{var q;return(q=M.voiceState)==null?void 0:q.voiceAPIStatus}),L=T(M=>{var q;return(q=M.voiceState)==null?void 0:q.voiceMsgProps}),F=T(M=>{var q;return(q=M.voiceState)==null?void 0:q.processingUserRequest}),y=T(M=>{var q,Y;return(Y=(q=M.voiceState)==null?void 0:q.data)==null?void 0:Y.intentType}),O=T(M=>{var q,Y;return(Y=(q=M.voiceState)==null?void 0:q.data)==null?void 0:Y.userRequest}),E=T(M=>M.languageState.languageData.languageKey),f=T(M=>M.openAIState.contextTokensTotal),p=T(M=>M.openAIState.messages),l=G(),S=le(),{handleAnswerToGeneralUserInput:C}=Ma(),{speechResponseToUserRequest:_}=Be(),{getGreetingsWithSSML:H}=se(),{getRealtimeDb:A}=d.useContext(he),{printDebug:N}=d.useContext(P),$=d.useCallback(()=>{N(`+++ INSIDE loading() - voiceAPIStatus => ${w}`),w===K.LOADING||F?s(!0):s(!1)},[w,F]),W=d.useCallback(()=>{L.status===V.START_SPEECH?i(!0):i(!1)},[L]),Xe=d.useCallback(()=>{_(H(E),"time-for-general-requests")},[w,E]),Ze=d.useCallback(async()=>{N("+++ INSIDE handleVoiceAPIIntents() +++ "),N(`+++ VOICE API STATUS => ${w} `),N(`+++ INTENT TYPE => ${y} `),y==="conversation-intent"&&(O.includes("ver correcciones")?ea():O.includes("volver a pantalla principal")?S("/"):await C(O,p)),l(ye())},[y,w]),ea=()=>{u(!0)};return d.useEffect(()=>{$()},[$]),d.useEffect(()=>{Xe()},[Xe]),d.useEffect(()=>{W()},[W]),d.useEffect(()=>{Ze()},[Ze]),d.useEffect(()=>{N(`+++ Inside useDialogController() - contextTokensTotal  => ${JSON.stringify(f)} `)},[f]),d.useEffect(()=>{let M;return(async()=>{const q=await A();if(!q){N("Error: No se pudo conectar a la Realtime Database.");return}const Y=bs(q,"Averages"),aa=vs(Y,fs(1));try{const X=await As(aa);if(X.exists()){const ne=X.val(),be=Object.keys(ne)[0],R=ne[be];R&&(x(R.Temp),g(R.Hum),v(R.MQ2),h(R.MQ3),D(R.MQ7),c(R.MQ135),I(R.MQ138))}}catch(X){console.error("Error en la carga inicial:",X)}M=js(aa,X=>{if(X.exists()){const ne=X.val(),be=Object.keys(ne)[0],R=ne[be];if(R){N("Actualizaci\xF3n en tiempo real recibida con alertas."),x(R.Temp),g(R.Hum),v(R.MQ2),h(R.MQ3),D(R.MQ7),c(R.MQ135),I(R.MQ138);const z=R.Alertes;z&&((z.Temp_Seule||z.Temp_Hum)&&(N("\xA1ALERTA DE TEMPERATURA DETECTADA EN JSON!"),l(He(!0))),z.Hum_Haute&&(N("\xA1ALERTA DE HUMEDAD ALTA DETECTADA EN JSON!"),l(Ue(!0))),z.Hum_Basse&&(N("\xA1ALERTA DE HUMEDAD BAJA DETECTADA EN JSON!"),l(_e(!0))),z.MQ2&&(N("\xA1ALERTA DE MQ2 DETECTADA EN JSON!"),l($e(!0))),z.MQ3&&(N("\xA1ALERTA DE MQ3 DETECTADA EN JSON!"),l(Fe(!0))),z.MQ7&&(N("\xA1ALERTA DE MQ7 DETECTADA EN JSON!"),l(ze(!0))),z.MQ135&&(N("\xA1ALERTA DE MQ135 DETECTADA EN JSON!"),l(Ge(!0))),z.MQ138&&(N("\xA1ALERTA DE MQ138 DETECTADA EN JSON!"),l(Ke(!0))))}}})})(),()=>{M&&(N("Deteniendo el escuchador de tiempo real."),M())}},[A,l]),{messages:p,seeCorrectionsEnabled:t,isLoading:a,isSpeechOn:o,latestTemperature:n,latestHumidity:r,latestMq2:b,latestMq3:k,latestMq7:j,latestMq135:B,latestMq138:m,handleOnTouchStartEvent:()=>{},handleSeeCorrectionsOnTouchEvent:ea,setSeeCorretionsEnabled:u}},qa=()=>{const{messages:a,seeCorrectionsEnabled:s,isLoading:o,isSpeechOn:i,latestTemperature:t,latestHumidity:u,latestMq2:n,latestMq3:x,latestMq7:r,latestMq135:g,latestMq138:b,handleOnTouchStartEvent:v,handleSeeCorrectionsOnTouchEvent:k,setSeeCorretionsEnabled:h}=Ra();return e.jsx(e.Fragment,{children:s?e.jsx(Ta,{messages:a,setSeeCorrectionsEnabled:h}):e.jsx(Na,{isLoading:o,isSpeechOn:i,latestTemperature:t,latestHumidity:u,latestMq2:n,latestMq3:x,latestMq7:r,latestMq135:g,latestMq138:b,handleOnTouchStartEvent:v,handleSeeCorrectionsOnTouchEvent:k})})},wa=()=>{const a={navBrand:{name:"Corrector di\xE1logo"},navBtns:[{name:"back-btn",icon:ts,path:"/startMenu"},{name:"debug-btn",icon:ns,path:"/debug"}],disableNavButton:!1},s={icon:e.jsx(ta,{icon:os,size:"lg"}),msg:"Hello Alexa, my name is Ana"};return e.jsxs(e.Fragment,{children:[e.jsx(fe,{navBrand:a.navBrand,navBtns:a.navBtns,disableNavButton:a.disableNavButton}),e.jsx(qa,{}),e.jsx(pa,{msg:s.msg,icon:s.icon})]})},Ba={languageData:{languageKey:-1,levelObject:{key:"",name:"",description:""},topicObject:{key:-2,name:"",description:""}}},Je=oe({name:"languageState",initialState:Ba,reducers:{setLanguageKey:(a,s)=>{a.languageData.languageKey=s.payload},setLevel:(a,s)=>{a.languageData.levelObject=s.payload},setTopicKey:(a,s)=>{a.languageData.topicObject=s.payload}}}),{setLanguageKey:Qe,setLevel:Ve,setTopicKey:We}=Je.actions,Pa=Je.reducer,La=()=>{const a="An\xF3nimo",s={key:"C1",name:"Avanzado Alto",description:"Capacidad de expresarse con fluidez y precisi\xF3n en temas complejos"},o={key:0,name:"Aleatorio",description:"Hablar sobre temas seleccionados de manera aleatoria"},i=T(h=>h.userDBState.userData),t=T(h=>{var j;return(j=h.voiceState)==null?void 0:j.voiceAPIStatus}),u=T(h=>{var j,D;return(D=(j=h.voiceState)==null?void 0:j.data)==null?void 0:D.userRequest}),n=T(h=>{var j,D;return(D=(j=h.voiceState)==null?void 0:j.data)==null?void 0:D.intentType}),x=G(),r=le(),{addUserToFirebaseDB:g}=pe(),{printDebug:b}=d.useContext(P),v=d.useCallback(async()=>{b("+++ INSIDE handleVoiceAPIIntents() +++ "),b(`+++ VOICE API STATUS => ${t} `),b(`+++ INTENT TYPE => ${n} `),n==="conversation-intent"&&u.includes("comenzar")&&k(),x(ye())},[n,t]),k=async()=>{x(xe()),x(me()),b("+++ Pseudonym => "+a),b("+++ Age => 30"),b("+++ userLanguage => 0"),b("+++ userLevel => "+s.name),b("+++ userTopic => "+o.name),x(Qe(0)),x(Ve(s)),x(We(o));let h={...i};h.pseudonym=a,h.age=30,h.languageName="Ingl\xE9s",h.levelName="Intermedio Alto",h.topicName="Aleatorio",h.timestamp=new Date().toLocaleString(),x(Oe(h)),await g(h).then(j=>{b(`Usuario agregado con docRefId: ${j}`),x(Ie(j))}).catch(j=>{b(`Error al agregar el nuevo usuario: ${j}`)}),r("/dialog")};d.useEffect(()=>{v()},[v])},Ha=()=>(La(),e.jsx(e.Fragment,{children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"container-menu-start-app-view",children:e.jsxs("div",{className:"grid-container-start-app-view",children:[e.jsx("div",{className:"item-logo-start-app-view",children:"Corrector di\xE1logo v15"}),e.jsx("div",{className:"item-button-start-app-view",children:e.jsx(de,{id:"start",path:"/startMenu",classStyle:"btn-primary item-button",type:"button",children:"Comenzar"})})]})})})})),Ua=({msg:a})=>{const s={navBrand:{name:"En Modo Debug"},navBtns:[{name:"exit-btn",icon:is,path:"/dialog"}],disableNavButton:!1};return e.jsxs(e.Fragment,{children:[e.jsx(fe,{navBrand:s.navBrand,navBtns:s.navBtns,disableNavButton:s.disableNavButton}),e.jsx("div",{className:"debug-container",children:e.jsxs("div",{className:"debug-container-grid",children:[e.jsx("div",{className:"debug-container-grid-item-traza",children:e.jsx("ul",{children:a.map((o,i)=>o&&e.jsx("li",{children:o},i))})}),e.jsx("div",{className:"debug-container-grid-item-input-btns",children:e.jsx("div",{className:"debug-container-grid-item-input-field",children:e.jsxs("div",{className:"input-group mb-3",children:[e.jsx("div",{className:"input-group-prepend",children:e.jsx("span",{className:"input-group-text",id:"inputGroup-sizing-default",children:"UID"})}),e.jsx("input",{type:"number",name:"uid",placeholder:"UID del usuario que ha realizado test usabilidad",pattern:"^[0-9]+$",title:"Solo se permiten n\xFAmeros",className:"form-control","aria-label":"Default","aria-describedby":"inputGroup-sizing-default",required:!0})]})})})]})})]})},Ye=a=>{let s=" ";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=o.length;for(let t=0;t<a;t++)s+=o.charAt(Math.floor(Math.random()*i));return s},_a=()=>{const[a,s]=d.useState(),[o,i]=d.useState(-1),[t,u]=d.useState(-1),[n,x]=d.useState({key:"",name:"",description:""}),[r,g]=d.useState({key:-2,name:"",description:""}),[b,v]=d.useState(""),[k,h]=d.useState(!0),[j,D]=d.useState(!1),B=T(A=>A.userDBState.userData),c=G(),m=le(),{addUserToFirebaseDB:I}=pe(),{getLanguageObjectByKey:w,getLanguageLevelObjectByKey:L,getLanguageTopicObjectByKey:F}=se(),{printDebug:y}=d.useContext(P),O=A=>{console.log("+++ PSEUDONYM Value +++ => "+A.target.value),s(A.target.value)},E=A=>{console.log("+++ AGE Value +++ => "+A.target.value),i(A.target.value)},f=A=>{console.log("+++ Language Value +++ => "+A.target.value),u(A.target.value)},p=A=>{console.log("+++ Level Value +++ => "+A.target.value);const N=L(A.target.value);x(N),g({key:-2,name:"",description:""})},l=A=>{if(console.log("+++ Topic Value +++ => "+A.target.value),A.target.value>0){const N=F(n.key,A.target.value);N&&g(N)}else A.target.value==0?g({key:0,name:"Aleatorio",description:"Tema aleatorio"}):g({key:-1,name:"Otros",description:""})},S=A=>{console.log("+++ Other Topic Value +++ => "+A.target.value),v(A.target.value),g({key:-1,name:"Otros",description:`Hablar sobre ${A.target.value}`})},C=d.useCallback(()=>{y("+++ Pseudonym => "+a),y("+++ Age => "+o),y("+++ userLanguage => "+t),y("+++ userLevel => "+n.name),y("+++ userTopic => "+r.name),a&&o>0&&t>=0&&n.key&&r.key!==-2?h(!1):h(!0)},[a,o,t,n,r]),_=async()=>{var N;D(!0),c(xe()),c(me());const A=H();if(y("+++ Pseudonym => "+a),y("+++ Age => "+o),y("+++ userPseudonym => "+A),y("+++ userLanguage => "+t),y("+++ userLevel => "+n),y("+++ userTopic => "+r),A&&o&&t&&n&&r){c(Qe(t)),c(Ve(n)),c(We(r));let $={...B};$.pseudonym=A,$.age=o,$.languageName=((N=w(t))==null?void 0:N.name)||"",$.levelName=n.name,$.topicName=r.name,$.timestamp=new Date().toLocaleString(),c(Oe($)),await I($).then(W=>{y(`Usuario agregado con docRefId: ${W}`),c(Ie(W))}).catch(W=>{y(`Error al agregar el nuevo usuario: ${W}`)}),m("/dialog")}else console.log("Las opciones no se han registrado adecuadamente")},H=d.useCallback(()=>a||(y("+++ inside getUserPseudonym => "+Ye(4)),Ye(4)),[a]);return d.useEffect(()=>{C()},[C]),{age:o,selectedLanguage:t,selectedLevel:n,selectedTopic:r,selectedOtherTopic:b,isDisabled:k,isLoading:j,handleChangeOnPseudonymInput:O,handleChangeOnAgeInput:E,handleChangeOnLanguageInput:f,handleChangeOnLevelInput:p,handleChangeOnTopicInput:l,handleChangeOnOtherTopicInput:S,handleStartButtonClick:_}},$a=()=>{const{age:a,selectedLanguage:s,selectedLevel:o,selectedTopic:i,selectedOtherTopic:t,isDisabled:u,isLoading:n,handleChangeOnPseudonymInput:x,handleChangeOnAgeInput:r,handleChangeOnLanguageInput:g,handleChangeOnLevelInput:b,handleChangeOnTopicInput:v,handleChangeOnOtherTopicInput:k,handleStartButtonClick:h}=_a(),j=Te,D=Object.entries(Ne),B=o.key?De[o.key]:[];return e.jsx(e.Fragment,{children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"container-menu-start-menu-view",children:e.jsxs("div",{className:"grid-container-start-menu-view",children:[e.jsx("div",{className:"item-start-menu-view",style:{display:"flex",alignItems:"center"},children:e.jsxs(ve,{children:[e.jsx("h5",{className:"header",children:"Rellena el siguiente formulario para poder comenzar el di\xE1logo"}),e.jsxs(Z,{children:[e.jsxs(U,{xs:3,className:"label",style:{display:"flex",alignItems:"center",fontWeight:"bold"},children:[e.jsx("div",{style:{color:"red"},children:"*"}),"Seud\xF3nimo"]}),e.jsx(U,{children:e.jsx(J,{children:e.jsx(J.Group,{controlId:"pseudonym",children:e.jsx(J.Control,{type:"string",placeholder:"Introduce los tres \xFAltimos d\xEDgitos del DNI del usuario (p.ej. 123X)",onChange:x})})})})]})," ",e.jsx("br",{}),e.jsxs(Z,{children:[e.jsxs(U,{xs:3,className:"label",style:{display:"flex",alignItems:"center",fontWeight:"bold"},children:[e.jsx("div",{style:{color:"red"},children:"*"}),"Edad"]}),e.jsx(U,{children:e.jsxs(J.Select,{className:"select","aria-label":"Default select example",value:a,onChange:r,children:[e.jsx("option",{className:"option",value:"-1",children:"Seleccione la edad del usuario"}),Array.from({length:100},(c,m)=>e.jsx("option",{className:"option",value:m,children:m},m))]})})]}),e.jsx("br",{}),e.jsxs(Z,{children:[e.jsxs(U,{xs:3,className:"label",style:{display:"flex",alignItems:"center",fontWeight:"bold"},children:[e.jsx("div",{style:{color:"red"},children:"*"}),"Idioma"]}),e.jsx(U,{children:e.jsxs(J.Select,{className:"select","aria-label":"Default select example",value:s,onChange:g,children:[e.jsx("option",{className:"option",value:"-1",children:"Selecciona un idioma"}),j.map(c=>e.jsx("option",{className:"option",value:c.key,children:c.name},c.key))]})})]}),e.jsx("br",{}),e.jsxs(Z,{children:[e.jsxs(U,{xs:3,className:"label",style:{display:"flex",alignItems:"center",fontWeight:"bold"},children:[e.jsx("div",{style:{color:"red"},children:"*"}),"Nivel"]}),e.jsx(U,{children:e.jsxs(J.Select,{className:"select","aria-label":"Default select example",value:o.key,onChange:b,children:[e.jsx("option",{className:"option",value:"-1",children:"Selecciona un nivel"}),D.map(([c,m])=>e.jsxs("option",{className:"option",value:m.key,children:[c," - ",m.name]},m.key))]})})]}),e.jsx("br",{}),e.jsxs(Z,{children:[e.jsxs(U,{xs:3,className:"label",style:{display:"flex",alignItems:"center",fontWeight:"bold"},children:[e.jsx("div",{style:{color:"red"},children:"*"}),"Tema"]}),e.jsxs(U,{children:[e.jsxs(J.Select,{className:"select","aria-label":"Default select example",value:i.key,onChange:v,children:[e.jsx("option",{className:"option",value:"-2",children:"Selecciona un tema despu\xE9s de elegir un nivel"}),e.jsx("option",{className:"option",value:"-1",children:"Otros"}),e.jsx("option",{className:"option",value:"0",children:"Aleatorio"}),B.map(c=>e.jsx("option",{className:"option",value:c.key,children:c.name},c.key))]}),e.jsx("br",{}),i.key==-1&&e.jsx(J.Group,{controlId:"otherTopicInput",children:e.jsx(J.Control,{type:"text",placeholder:"Introduce el tema deseado",value:t,onChange:k})})]})]})]})}),e.jsx(ve,{children:e.jsx(Z,{style:{display:"flex",justifyContent:"center"},children:e.jsx(U,{xs:"6",className:"item-button-start-menu-view",children:e.jsx(Ns,{id:"start",className:"btn-primary item-button",type:"button",onTouchEnd:h,disabled:u||n,children:e.jsx(ve,{children:e.jsxs(Z,{children:[n&&e.jsx(U,{xs:"2",children:e.jsx(Ds,{as:"span",animation:"border",role:"status","aria-hidden":"true"})}),e.jsx(U,{children:"Comenzar"})]})})})})})})]})})})})},Fa=()=>{const[a,s]=d.useState(null),[o,i]=d.useState([]),t=G(),u=d.useCallback(async()=>{r("Beginning Alexa.create"),window.Alexa?window.Alexa.create({version:"1.0"}).then(c=>{c.alexa?(s(c.alexa),c.alexa.skill.onMessage(v),c.alexa.speech.onStarted(k),c.alexa.speech.onStopped(h),c.alexa.voice.onMicrophoneOpened(j),c.alexa.voice.onMicrophoneClosed(D),r("Alexa is ready - newest version 5 :) Received initial data 45"),c.message.deviceId&&(r("Alexa Skill init data: "+c.message.deviceId),console.log("Alexa Skill init data: "+c.message.deviceId),t(Da(c.message.deviceId))),t(re(K.OK))):(r(`Alexa failed to initialize, code: ${c.code}`),t(re(K.NOT_OK)))}).catch(c=>{r(`Alexa not ready :(. Error: ${c}`),t(re(K.NOT_OK))}):t(re(K.NOT_OK))},[]),n=c=>{i(m=>[...m,c]),console.log(c)},x=()=>{i([])},r=c=>{n(typeof c!="string"?JSON.stringify(c,null,2):c)},g=c=>{c.statusCode==200?r("message was sent to backend successfully"):(t(te(V.END_SPEECH)),r("failed to send message to skill backend:"))},b=d.useCallback(async c=>{try{r("sending message to skill endpoint ==> "+JSON.stringify(c)),r("+++ INSIDE sendMessage - alexaClient ==> "+a),await a.skill.sendMessage(c,g)}catch(m){t(te(V.END_SPEECH)),r("Alexa error ==> "+m)}},[a]),v=c=>{let m;r("Web APP received a message from the skill endpoint"),r(c),c&&(m={intentType:c.intentType,userRequest:c.userRequest},t(we(!0)),t(ka(m)))},k=()=>{t(te(V.START_SPEECH))},h=()=>{t(te(V.END_SPEECH))},j=()=>{t(qe(ie.MICROPHONE_OPENED))},D=()=>{t(qe(ie.MICROPHONE_CLOSED))},B=d.useCallback(()=>{t(ye())},[]);return d.useEffect(()=>{u()},[]),{debugMessages:o,printDebug:r,sendMessage:b,resetVoiceIntent:B,resetDebugMessages:x}},za=()=>{const a=G(),{debugMessages:s,printDebug:o,sendMessage:i,resetDebugMessages:t}=Fa();return{debugMessages:s,printDebug:o,sendLogToAlexa:async(u,n)=>{u===K.OK&&await i({intentRequest:"log-text-intent",logTxt:n})},sendTextToAlexa:async(u,n,x)=>{u===K.OK&&(a(te(V.SEND_SPEECH)),await i({intentRequest:"text-to-speech-intent",speech:n,otherInfo:x}))},resetDebugMessages:t}},Ga="AIzaSyA7K4iBtMY9QYK81wWEAEOo5CXaqDv3XaM",Ka="dialoguecorrector.firebaseapp.com",Ja="dialoguecorrector",Qa="dialoguecorrector.appspot.com",Va="267956715419",Wa="1:267956715419:web:55a730f6474b444ba26b3e",ee={DB_API_KEY:Ga,DB_AUTH_DOMAIN:Ka,DB_PROJECT_ID:Ja,DB_STORAGE_BUCKET:Qa,DB_MESSAGING_SENDER_ID:Va,DB_APP_ID:Wa},Ya=()=>{const[a,s]=d.useState(null),[o,i]=d.useState(null),t=()=>{const n={apiKey:ee.DB_API_KEY,authDomain:ee.DB_AUTH_DOMAIN,projectId:ee.DB_PROJECT_ID,storageBucket:ee.DB_STORAGE_BUCKET,messagingSenderId:ee.DB_MESSAGING_SENDER_ID,appId:ee.DB_APP_ID},x={apiKey:"AIzaSyBRN3vx4gAKd4qXNE1VQD1Ht_LILh_47UI",authDomain:"alexa-sensors-5b561.firebaseapp.com",databaseURL:"https://alexa-sensors-5b561-default-rtdb.europe-west1.firebasedatabase.app",projectId:"alexa-sensors-5b561",storageBucket:"alexa-sensors-5b561.appspot.com",messagingSenderId:"180971277054",appId:"1:180971277054:web:d0e5f55f33bea83ac3b3af"};let r,g;const b=Ts(),v=b.find(h=>h.name==="[DEFAULT]"),k=b.find(h=>h.name==="sensorApp");return v?r=v:r=na(n),k?g=k:g=na(x,"sensorApp"),s(r),i(g),{user:r,sensor:g}},u=async n=>{const x=ks(n);try{return await Cs(x),!1}catch(r){return console.error(`Fallo en el inicio de sesi\xF3n an\xF3nimo para ${n.name}: ${r}`),!0}};return{getFirestoreDb:async()=>{let n=a;return n||(n=t().user),n&&!await u(n)?Ss(n):null},getRealtimeDb:async()=>{let n=o;return n||(n=t().sensor),n?Es(n):null}}},he=sa.createContext({}),P=sa.createContext({});function Xa(){const{getFirestoreDb:a,getRealtimeDb:s}=Ya(),{debugMessages:o,printDebug:i,sendLogToAlexa:t,sendTextToAlexa:u,resetDebugMessages:n}=za();return e.jsx(e.Fragment,{children:e.jsx(he.Provider,{value:{getFirestoreDb:a,getRealtimeDb:s},children:e.jsx(P.Provider,{value:{debugMessages:o,printDebug:i,sendLogToAlexa:t,sendTextToAlexa:u,resetDebugMessages:n},children:e.jsx(ss,{basename:ae.BASE_ROUTE,children:e.jsxs(rs,{children:[e.jsx(ce,{path:ae.START_APP_ROUTE,element:e.jsx(Ha,{})}),e.jsx(ce,{path:ae.START_MENU_ROUTE,element:e.jsx($a,{})}),e.jsx(ce,{path:ae.DIALOG_ROUTE,element:e.jsx(wa,{})}),e.jsx(ce,{path:ae.DEBUG_ROUTE,element:e.jsx(Ua,{msg:o})})]})})})})})}const Za={serializableCheck:{ignoredActions:["userDBState/setUserDocRef"],ignoredPaths:["userDBState.userData.docRef"]}},es=ds({reducer:{voiceState:Ca,openAIState:ba,userDBState:Sa,languageState:Pa,environmentState:Oa},middleware:a=>a(Za)});as.createRoot(document.getElementById("root")).render(e.jsx(cs,{store:es,children:e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),e.jsx(Xa,{})]})}))});
